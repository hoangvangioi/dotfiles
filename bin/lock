#!/bin/bash

set -euo pipefail

# Dracula theme colors
alpha='dd'
selection='#44475a'
orange='#ffb86c'
red='#ff5555'
magenta='#ff79c6'
blue='#6272a4'
green='#50fa7b'

# Check required commands
if ! command -v i3lock &>/dev/null; then
    echo "Error: i3lock not found. Please install i3lock-color." >&2
    exit 1
fi

# Cleanup function to ensure notifications are resumed
cleanup() {
    if command -v dunstctl &>/dev/null; then
        dunstctl set-paused false
    fi
}

trap cleanup EXIT INT TERM

# Pause notifications
if command -v dunstctl &>/dev/null; then
    dunstctl set-paused true
fi

i3lock \
    --insidever-color=$selection$alpha \
    --insidewrong-color=$selection$alpha \
    --inside-color=$selection$alpha \
    --ringver-color=$green$alpha \
    --ringwrong-color=$red$alpha \
    --ring-color=$blue$alpha \
    --line-uses-ring \
    --keyhl-color=$magenta$alpha \
    --bshl-color=$orange$alpha \
    --separator-color=$selection$alpha \
    --verif-color=$green \
    --wrong-color=$red \
    --modif-color=$red \
    --layout-color=$blue \
    --date-color=$blue \
    --time-color=$blue \
    --screen 1 \
    --blur 1 \
    --clock \
    --indicator \
    --time-str="%H:%M:%S" \
    --date-str="%A %e %B %Y" \
    --verif-text="Checking..." \
    --wrong-text="Wrong pswd" \
    --noinput="No Input" \
    --lock-text="Locking..." \
    --lockfailed="Lock Failed" \
    --radius=120 \
    --ring-width=10 \
    --pass-media-keys \
    --pass-screen-keys \
    --pass-volume-keys \
    --time-font="JetBrainsMono Nerd Font" \
    --date-font="JetBrainsMono Nerd Font" \
    --layout-font="JetBrainsMono Nerd Font" \
    --verif-font="JetBrainsMono Nerd Font" \
    --wrong-font="JetBrainsMono Nerd Font" \
    --keylayout 1

# Cleanup will be called automatically via trap
